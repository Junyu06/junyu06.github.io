{{- define "main" -}}

<!-- Section with only _index.md content (no child pages): show content directly -->
{{- $pages := union .RegularPages .Sections -}}
{{- if .IsHome -}}
{{- $pages = where site.RegularPages "Type" "in" site.Params.mainSections -}}
{{- else if eq .Section "projects" -}}
{{- $pages = union (sort .RegularPages "Weight" "desc") .Sections -}}
{{- end -}}

{{- if and (not .IsHome) (eq (len $pages) 0) .Content -}}
<article class="site-portal">
  <header class="mb-14">
    <h1 class="my-0! pb-2.5">{{- .Title -}}</h1>
  </header>
  <section>{{- .Content -}}</section>
</article>
{{- else -}}

<!-- Tag Title -->
{{- if and .Title (eq .Type "tags") -}}
<h1 class="mb-14">#{{- .Title -}}</h1>
{{- end -}}

<!-- $pages -->
{{- $paginator := .Paginate $pages -}} {{- range $index, $page :=
$paginator.Pages -}}

<!-- avatar -->
{{- if and $.IsHome (eq $paginator.PageNumber 1) (eq $index 0) -}}

{{- $avatar_url := $.Scratch.Get "avatar_url" -}}
{{- if or $avatar_url site.Params.name -}}
<div class="-mt-2 mb-12 flex items-center">
  {{- if $avatar_url -}}
  <div
    class="h-24 w-24 shrink-0 rounded-full border-[0.5px] border-black/10 bg-white/50 p-3 ltr:mr-5 ltr:-ml-1 rtl:-mr-1 rtl:ml-5 dark:bg-white/90!"
  >
    <img
      class="not-prose my-0 h-full w-full rounded-full bg-black/5! hover:animate-spin dark:bg-black/80!"
      src="{{- $avatar_url -}}"
      alt="{{- site.Params.name | default site.Title -}}"
    />
  </div>
  {{- end -}}
  {{- if site.Params.name -}}
  <div>
    <div class="mt-3 mb-1 text-2xl font-medium text-black dark:text-white">
      {{- site.Params.name -}}
    </div>
    <div class="break-words">
      {{- site.Params.bio | default (print `A personal blog by `
      site.Params.name) -}}
    </div>
  </div>
  {{- end -}}
</div>
{{- end -}}

{{- end -}}

<section class="relative my-10 first-of-type:mt-0 last-of-type:mb-0 {{ if and (eq $.Section "projects") (gt .Weight 0) }}rounded-xl border border-slate-200/80 bg-slate-50/70 dark:border-slate-700/80 dark:bg-slate-800/20 py-4{{ end }}">
  {{- if gt .Weight 0 -}}
  <span class="mb-1 inline-block text-xs tracking-wider text-orange-500"
    >Featured</span
  >
  {{- end -}}
  <h2 class="my-0! {{ if and (eq $.Section "projects") (gt .Weight 0) }}font-semibold{{ end }}">
    {{- if eq $.Section "projects" -}}
    <a
      class="relative z-10 no-underline hover:underline underline-offset-4"
      href="{{- .Permalink -}}"
      >{{- .Title -}}</a
    >
    {{- else -}}
    {{- .Title -}}
    {{- end -}}
  </h2>
  {{- if ne .Section "projects" -}}
  <time class="text-xs antialiased opacity-60"
    >{{- .Date | time.Format ":date_medium" -}}</time
  >
  {{- else -}}
  {{- with .Params.summary -}}
  <p class="my-2 text-sm leading-relaxed opacity-80">{{- . -}}</p>
  {{- end -}}
  {{- if and (eq $.Section "projects") .Params.live_url -}}
  <p class="my-1.5">
    <a href="{{ .Params.live_url }}" target="_blank" rel="noopener noreferrer" class="relative z-10 inline-flex items-center gap-1 text-xs font-medium text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100 underline underline-offset-2"
      ><svg width="14" height="14" class="shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>Visit safeclick.dev</a
    >
  </p>
  {{- end -}}
  {{- if eq $.Section "projects" -}}
  {{- with .Params.portfolio_keywords -}}
  <p class="my-0 text-xs tracking-wide opacity-70">{{- . -}}</p>
  {{- end -}}
  {{- else -}}
  {{- if .Params.tags -}}
  <p class="my-1.5 flex flex-wrap gap-1.5">
    {{- range .Params.tags -}}
    <span class="inline-block rounded-md bg-orange-500/15 px-2 py-0.5 text-xs font-medium text-orange-700 dark:text-orange-300">{{- . -}}</span>
    {{- end -}}
  </p>
  {{- else -}}
  {{- with .Params.portfolio_keywords -}}
  <p class="my-0 text-xs tracking-wide opacity-70">{{- . -}}</p>
  {{- end -}}
  {{- end -}}
  {{- end -}}
  {{- end -}}
  {{- if ne $.Section "projects" -}}
  <a class="absolute inset-0 z-0 text-[0px]" href="{{- .Permalink -}}"
    >{{- .Title -}}</a
  >
  {{- end -}}
</section>
{{- end -}}

<!-- Main Nav -->
{{- if gt $paginator.TotalPages 1 -}}
<nav class="mt-14 flex">
  {{- if $paginator.HasPrev -}}
  <a class="btn not-prose" href="{{- $paginator.Prev.URL -}}"
    >← {{- i18n "prev_page" -}}</a
  >
  {{- end -}}
  {{- if $paginator.HasNext -}}
  <a class="btn not-prose ml-auto" href="{{- $paginator.Next.URL -}}"
    >{{- i18n "next_page" -}} →</a
  >
  {{- end -}}
</nav>
{{- end -}}

{{- end -}}

{{- end -}}
